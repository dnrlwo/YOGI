<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org/DTD Mapper 3.0//en"
       "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
       
<mapper namespace="homes">
	<!-- 숙소 리스트 -->
	<select id = "homes_search" parameterType="String" resultType="bean.HomesVo">
		SELECT hSerial, hEmail, hName, hContent, hType, hAddress, hPrice,
		ROUND( (SELECT (( SUM(c.cClean) + SUM(c.cService) + SUM(c.cLocation) )/3)/COUNT(*) 
		FROM COMMENTS c
		WHERE c.cPserial = h.hSerial
		GROUP BY c.cPserial) , 1 ) grade
		FROM HOUSE h
		WHERE hEmail like '%${findStr}%' or hName like '%${findStr}%' or hAddress like '%${findStr}%'
		ORDER BY grade DESC NULLS LAST
	</select>
	
	<!-- 숙소 사진들 -->
	<select id = "homes_photo" parameterType="Integer" resultType="bean.HFilesVo">
		select fPhoto from hFiles where fPserial = #{_parameter}
	</select>
	
	<!-- 숙소 검색 -->
	<select id="select" parameterType="Integer" resultType="bean.HomesVo">
		SELECT * FROM HOUSE WHERE HSERIAL = #{_parameter}
	</select>
	
	<!-- 숙소 상세내용 -->
	<select id="details" parameterType="Integer" resultType="bean.DetailsVo">
		SELECT * FROM DETAILS WHERE DPSERIAL = #{_parameter}
	</select>
</mapper>
